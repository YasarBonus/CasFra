<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.8.8/semantic.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.8.8/semantic.min.js"></script>
</head>
<body>
    <h2>Dashboard</h2>

    <form id="addDataForm">
        <label for="newData">Title:</label>
        <input type="text" id="newTitle" name="newTitle" required>
        <label for="newData">Content:</label>
        <input type="text" id="newContent" name="newContent" required>
        <input type="submit" value="Add Data">
    </form>

    <script>
    
        $('#addDataForm').on('submit', function(e) {
            e.preventDefault();
    
            const title = $('#newTitle').val();
            const content = $('#newContent').val();
    
            $.ajax({
                url: '/add-data',
                type: 'POST',
                data: { title: title, content: content},
                success: function(result) {
                    // Do something with the result
                    location.reload(); // Reload the page
                }
            });
        });
    </script>

<ul id="dataList"></ul>

<script>

fetch('/get-data')
.then(response => response.json())
.then(data => {
    console.log(data);

    const dataList = document.getElementById('dataList');

    function displayData() {
        dataList.innerHTML = ''; // Clear the table
        data.forEach(item => {
            const tr = document.createElement('tr');

            const titleCell = document.createElement('td');
            titleCell.textContent = item.title;
            titleCell.contentEditable = true; // Make the data editable
            tr.appendChild(titleCell);

            const contentCell = document.createElement('td');
            contentCell.textContent = item.content;
            contentCell.contentEditable = true; // Make the data editable
            tr.appendChild(contentCell);

            const saveButtonCell = document.createElement('td');
            const saveButton = document.createElement('button');
            saveButton.textContent = 'Save';
            saveButton.addEventListener('click', function() {
                const newTitle = titleCell.textContent;
                const newContent = contentCell.textContent;

                $.ajax({
                    url: '/update-data',
                    type: 'POST',
                    data: { id: item.id, title: newTitle, content: newContent },
                    success: function(result) {
                        // Do something with the result
                        location.reload(); // Reload the page
                    }
                });
            });
            saveButtonCell.appendChild(saveButton);
            tr.appendChild(saveButtonCell);

            const deleteButtonCell = document.createElement('td');
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.addEventListener('click', function() {
                $.ajax({
                    url: '/delete-data',
                    type: 'POST',
                    data: { id: item.id },
                    success: function(result) {
                        // Do something with the result
                        location.reload(); // Reload the page
                    }
                });
            });
            deleteButtonCell.appendChild(deleteButton);
            tr.appendChild(deleteButtonCell);

            dataList.appendChild(tr);
        });
    }

    displayData();
})
.catch(error => console.error('Error:', error));

</script>

    <button id="saveData">Daten an die Webseite übermitteln</button>

    <script>
        // ...

        $('#saveData').on('click', function() {
            $.ajax({
                url: '/save-data',
                type: 'POST',
                success: function(result) {
                    // Do something with the result
                    alert('Daten gespeichert!');
                    location.reload(); // Reload the page

                }
            });
        });

        // ...
    </script>

<button id="loadData">Daten von der Website laden (Achtung: unsicher!)</button>

<script>
    $('#loadData').on('click', function() {
        $.ajax({
            url: '/load-data',
            type: 'POST',
            success: function(result) {
                // Do something with the result
                alert('Daten geladen!');
                location.reload(); // Reload the page
            }
        });
    });
</script>

<br>

<button id="backupData">Backup der Daten erstellen</button>

<script>
    $('#backupData').on('click', function() {
        $.ajax({
            url: '/create-backup',
            type: 'POST',
            success: function(result) {
                // Do something with the result
                alert('Backup erstellt!');
                location.reload(); // Reload the page
            }
        });
    });
</script>

<button id="loadjsondata">data.json einlesen (Achtung, gefährlich)</button>

<script>
    $('#loadjsondata').on('click', function() {
        $.ajax({
            url: '/load-json-data',
            type: 'GET',
            success: function(result) {
                // Do something with the result
                alert('Done!');
                location.reload(); // Reload the page
            }
        });
    });
</script>

<ul id="tableList"></ul>

<div id="dataModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close">&times; schließen</span>
        <pre id="modalData"></pre>
    </div>
</div>

<script>
    // ...

    // Get the table names when the page loads
    $.ajax({
        url: '/get-table-names',
        type: 'GET',
        success: function(result) {
            // Add a list item and restore and delete buttons for each table
            result.forEach(table => {
                $('#tableList').append(`
                    <li>
                        ${table}
                        <button class="restoreButton" data-table="${table}">Wiederherstellen</button>
                        <button class="deleteButton" data-table="${table}">Löschen</button>
                        <button class="showDataButton" data-table="${table}">Daten anzeigen</button>
                    </li>
                `);
            });

            // Add an event listener for the restore buttons
            $('.restoreButton').on('click', function() {
                const table = $(this).data('table');

                $.ajax({
                    url: '/restore-table',
                    type: 'POST',
                    data: { table: table },
                    success: function(result) {
                        // Do something with the result
                        alert('Tabelle wiederhergestellt!');
                        location.reload(); // Reload the page
                    }
                });
            });

            // Add an event listener for the delete buttons
            $('.deleteButton').on('click', function() {
                const table = $(this).data('table');

                $.ajax({
                    url: '/delete-table',
                    type: 'POST',
                    data: { table: table },
                    success: function(result) {
                        // Do something with the result
                        alert('Tabelle gelöscht!');
                        location.reload(); // Reload the page
                    }
                });
            });

            // Add an event listener for the show data buttons
$('.showDataButton').on('click', function() {
    const table = $(this).data('table');

    // Show the table name
    $('#modalData').html('<h5>Showing Backup: ' + table + '</h5>');

    $.ajax({
        url: '/show-table-data',
        type: 'POST',
        data: { table: table },
        success: function(result) {
            // Insert the data into the modal
            $('#modalData').append('<pre>' + JSON.stringify(result, null, 2) + '</pre>');

            // Open the modal
            $('#dataModal').show();
        }
    });
});

// Get the modal
var modal = document.getElementById("dataModal");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}




        }
    });

    // ...
</script>

</body>
</html>
