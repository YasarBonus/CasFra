<div class="ui small menu">
    <% if (user.permissions.includes('viewDashboard')) { %>
        <a class="item" href="/dashboard">Dashboard</a>
    <% } %>
    <% if (user.permissions.includes('manageCasinos')) { %>
        <a class="item" href="/dashboard/casinos">Casinos</a>
    <% } %>

      <div class="ui dropdown item">
          Tenancy <i class="dropdown icon"></i>
          <div class="menu">
            <a href="/dashboard/casinos/categories" class="item">Casino Categories</a>
            <a href="/dashboard/casinos/tags" class="item">Casino Tags</a>
            <a href="/dashboard/casinos/features" class="item">Casino Features</a>
            <a href="/dashboard/casinos/providers" class="item">Casino Providers</a>
            <a href="/dashboard/casinos/paymentmethods" class="item">Casino Payment Methods</a>
            <a href="/dashboard/casinos/licenses" class="item">Casino Licenses</a>
          </div>
        </div>
        
    <% if (user.permissions.includes('manageLinks')) { %>
        <div class="ui dropdown item">
            ShortLinks <i class="dropdown icon"></i>
            <div class="menu">
              <a href="/dashboard/shortlinks" class="item">Manage</a>
              <a href="/dashboard/shortlinks/hits" class="disabled item">Hits</a>
            </div>
          </div>
    <% } %>
    <% if (user.permissions.includes('manageImages') || user.permissions.includes('manageImagesCategories')) { %>
        <div class="ui dropdown item">
            Images <i class="dropdown icon"></i>
            <div class="menu">
                <% if (user.permissions.includes('manageImages')) { %>
                    <a class="item" href="/dashboard/images">Images</a>
                <% } %>
                <% if (user.permissions.includes('manageImagesCategories')) { %>
                  <a class="item" href="/dashboard/images/categories">Image Categories</a>
              <% } %>
            </div>
          </div>
    <% } %>
    
    <div class="right menu">
        <% if (user.permissions.includes('superAdmin') || user.permissions.includes('manageRegistrationKeys') 
            || user.permissions.includes('manageSessions')) { %>
            <div class="ui dropdown item">
                Super <i class="dropdown icon"></i>
                <div class="menu">
                  <% if (user.permissions.includes('manageUsers')) { %>
                    <a class="item" href="/dashboard/super/users">Users</a>
                <% } %>
                    <% if (user.permissions.includes('manageRegistrationKeys')) { %>
                        <a class="item" href="/dashboard/super/registrationkeys">Registration Keys</a>
                    <% } %>
                    <% if (user.permissions.includes('manageSessions') || user.permissions.includes('superAdmin')) { %>
                        <a class="item" href="/dashboard/super/sessions">User Sessions</a>
                    <% } %>

                </div>
              </div>
              
        <% } %>

            
        <% if (user.tenancy) { %>
        <div class="ui tenancies dropdown item">
          <i class="building icon"></i> <i class="dropdown icon"></i>
          <div class="menu">
              <a href="/dashboard/account" class="item">Manage Account</a>
          </div>
        </div>
        <% } %>
        
          <div class="ui dropdown item">
            <i class="user icon"></i><%= user.username %> <i class="dropdown icon"></i>
            <div class="menu">
                <a href="/dashboard/account" class="item">Manage Account</a>
 
            </div>
          </div>
      <div class="item">
        <div id="logoutButton" class="ui right labeled icon button" onclick="callLogoutAPI()">Logout</div>
    </div>
  </div>
</div>
  <script>
showActionButton('logoutButton', 'logout'); 
    callLogoutAPI = () => {
      showActionButton('logoutButton', 'loading'); 
      $.ajax({
        url: '/api/auth/logout',
        type: 'POST',
        success: function(result) {
          window.location.href = '/login';
        }
      });
    };

    $('.ui.dropdown')
      .dropdown()
    ;
    </script>

<!--  Additional Code only for users -->

<% if (user) { %>

<script>
  function fetchTenancies() {
    fetch('/api/user/tenancies')
      .then(response => response.json())
      .then(data => {
        const dropdownMenu = document.querySelector('.tenancies.dropdown .menu');
        dropdownMenu.innerHTML = '';

        data.forEach(tenancy => {
          const item = document.createElement('a');
          item.classList.add('item');
          item.onclick = switchTenancy(tenancy._id);
          item.textContent = tenancy.name;
          dropdownMenu.appendChild(item);
        });

        $('.tenancies.dropdown').dropdown();
      })
      .catch(error => {
        console.error('Error fetching tenancies:', error);
      });
  }

  fetchTenancies();

  function switchTenancy(tenancyId) {
    return () => {
      fetch(`/api/user/tenancy/${tenancyId}`, { method: 'PUT' })
        .then(response => response.json())
        .then(data => {
          window.location.reload();
        })
        .catch(error => {
          console.error('Error switching tenancy:', error);
        });
    };
  }
</script>

<% } %>

<!-- Rest of the code... -->

