<!-- registration-keys.ejs -->
<!DOCTYPE html>
<html>
    <%- include('../partials/head') %>
    <%- include('../partials/header') %>
    <body class="bg-yasarred">
        <div class="ui container" style="margin-top: 100px !important; padding-bottom: 100px;">
            <div class="ui segment">
                <%- include('./partials/dashboard-menu') %>
                <div class="ui segment">
                    <h2>Registration Keys</h2>
                    <div class="ui negative message">
                        <div class="header">
                          Danger!
                        </div>
                        <p>Anyone with a registration key can sign up and modify the website data!</p>
                      </div>

                    <!-- Button zum Generieren neuer Schlüssel -->
                    <button id="generate-key-button" class="ui green button">Generate Key</button>

                    <!-- Tabelle der Schlüssel -->
                    <table id="keys-table" class="ui celled table">
                        <thead>
                            <tr>
                                <th>Key</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Die Schlüssel werden hier eingefügt -->
                        </tbody>
                    </table>
                </div>
            </div>
            <%- include('../partials/footer') %>
        </body>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.8/dist/semantic.min.js"></script>
        <script>
            // ajax.js
$(document).ready(function() {
    // Schlüssel beim Laden der Seite abrufen
    $.ajax({
        url: '/api/auth/regkeys',
        type: 'GET',
        success: function(data) {
            // Schlüssel zur Tabelle hinzufügen
            data.forEach(function(item) {
                $('#keys-table tbody').append('<tr><td>' + item.regkey + '</td><td><button class="ui red small button delete-button" data-id="' + item.id + '">Delete</button></td></tr>');
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // Fehlerbehandlung
            console.error(textStatus, errorThrown);
        }
    });

    // Button zum Generieren von Schlüsseln klicken
    $('#generate-key-button').click(function() {
        $.ajax({
            url: '/api/auth/regkeys/generate',
            type: 'POST',
            success: function(data) {
                // Generierten Schlüssel zur Tabelle hinzufügen
                $('#keys-table tbody').append('<tr><td>' + data.regkey + '</td><td><button class="ui red small button delete-button" data-id="' + data.id + '">Delete</button></td></tr>');
            },
            error: function(jqXHR, textStatus, errorThrown) {
                // Fehlerbehandlung
                console.error(textStatus, errorThrown);
            }
        });
    });

    // Schlüssel löschen
$('#keys-table').on('click', '.delete-button', function() {
    var id = $(this).data('id');
    var row = $(this).closest('tr'); // Speichern Sie das aktuelle Element in einer Variablen

    $.ajax({
        url: '/api/auth/regkeys/delete',
        type: 'POST',
        data: { id: id },
        success: function(data) {
            // Schlüssel aus der Tabelle entfernen
            row.remove(); // Verwenden Sie die gespeicherte Variable, um die Zeile zu entfernen
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // Fehlerbehandlung
            console.error(textStatus, errorThrown);
        }
    });
});
});
        </script>
</html>